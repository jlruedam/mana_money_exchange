{% extends 'exchange/base.html' %}
{% load static %}
{% load humanize exchange_filters %}

{% block title %}Administrar Divisas - Mana Money Exchange{% endblock %}

{% block content %}
<section class="hero-section">
    <header>
        <input type="checkbox" id="menu-toggle">
        <label for="menu-toggle" class="menu-icon"><span class="material-symbols-outlined">menu</span></label>
        <nav class="nav-menu">
            <a href="/"><img src="{% static 'exchange/img/logoblue.png' %}" alt="Logo azul de Mana Money Exchange"></a>
            <ul>
                <li><a href="/#nosotros"><span class="material-symbols-outlined">info</span>Nosotros</a></li>
                <li><a href="/#Calculadora"><span class="material-symbols-outlined">calculate</span>Calculadora</a></li>
                <li><a href="/#oficina"><span class="material-symbols-outlined">location_on</span>Oficina</a></li>
                <li><a href="https://wa.link/0eqprb" target="_blank"><span class="material-symbols-outlined">chat</span>Contáctanos</a></li>
                {% if user.is_authenticated %}
                <li><a href="{% url 'divisa_list' %} "><span class="material-symbols-outlined">currency_exchange</span>Administrar Divisas</a></li>
                <li><a href="{% url 'logout' %}"><span class="material-symbols-outlined">logout</span>Salir</a></li>
                {% else %}
                <li><a href="{% url 'login' %}"><span class="material-symbols-outlined">login</span>Login</a></li>
                {% endif %}
            </ul>
        </nav>
        <div class="logo">
            <a href="/">
                <img class="logo-img-white" src="{% static 'exchange/img/mana_logowhite.png' %}" alt="Logo de Mana Money Exchange">
            </a>
        </div>
        <div class="false-div">
        </div>
    </header>

    <div class="divisa-list-container">
        <h1>Administrar Divisas</h1>
        <button id="open-modal-btn" class="button">Crear nueva divisa</button>
        <ul class="divisa-list">
            {% for divisa in divisas %}
            <li class="divisa-item">
                <div class="divisa-info">
                    <img src="{% url 'flag_proxy' flag_code=divisa.bandera %}" alt="Bandera de {{ divisa.nombre }}" class="divisa-flag">
                    <span>{{ divisa.nombre }}</span>
                    <span>Compra: ${{ divisa.compra|format_decimal }}</span>
                    <span>Venta: ${{ divisa.venta|format_decimal }}</span>
                </div>
                <div class="divisa-actions">
                    <button class="button edit-btn" 
                            data-pk="{{ divisa.pk }}"
                            data-nombre="{{ divisa.nombre }}"
                            data-compra="{{ divisa.compra }}"
                            data-venta="{{ divisa.venta }}"
                            data-bandera="{{ divisa.bandera }}">Editar</button>
                    <a href="{% url 'divisa_delete' pk=divisa.pk %}" class="button delete-btn" onclick="return confirm('¿Estás seguro de que quieres eliminar esta divisa?');">Eliminar</a>
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>
</section>

<!-- Modal para Crear/Editar Divisa -->
<div id="divisa-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h1 id="modal-title">Crear Divisa</h1>
        <form id="divisa-form" method="post" action="{% url 'divisa_create' %}">
            {% csrf_token %}
            <div class="form-group">
                <label for="id_nombre" class="form-label">Nombre:</label>
                {{ form.nombre }}
            </div>
            <div class="form-group">
                <label for="id_compra" class="form-label">Compra:</label>
                {{ form.compra }}
            </div>
            <div class="form-group">
                <label for="id_venta" class="form-label">Venta:</label>
                {{ form.venta }}
            </div>
            <div class="form-group">
                <label for="id_bandera" class="form-label">Bandera:</label>
                <select name="bandera" id="id_bandera" class="form-control">
                    {% for code, name, flag_url in flag_choices %}
                        <option value="{{ code }}" data-flag-url="{{ flag_url }}" {% if form.bandera.value == code %}selected{% endif %}>{{ name }}</option>
                    {% endfor %}
                </select>
                <div id="selected-flag-display" class="flag-display"></div>
            </div>
            <button type="submit" class="button">Guardar</button>
        </form>
    </div>
</div>
{% endblock %}
